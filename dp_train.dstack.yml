type: task

# Use either `python` or `image` to configure environment
#python: "3.9"
image: mlcommons/gandlf:latest-cuda121

env:
    - CUDA_VISIBLE_DEVICES=0
    - AWS_DEFAULT_REGION=us-west-2
    - AWS_SECRET_ACCESS_KEY
    - AWS_ACCESS_KEY_ID

commands:
  - apt-get install git -y
  - python3.9 -m pip install awscli
  - aws s3 ls s3://vukw-1e2df75b/
  - aws s3 cp s3://vukw-1e2df75b/gandlf_dp/data.tar.gz data.tar.gz && tar -xzf data.tar.gz
  - aws s3 cp s3://vukw-1e2df75b/gandlf_dp/gandlf-vanilla.tar.gz gandlf.tar.gz && tar -xzf gandlf.tar.gz
  - ls -lGghrt .
  - pwd
  - python3.9 -m pip uninstall gandlf -y
  - python3.9 -m pip install -e ./GaNDLF/
  - python3.9 -m pip list
  - python3.9 --version
  - chmod +x ./main.sh
  - /bin/bash ./main.sh -m model-vanilla


# (Optional) Configure `gpu`, `memory`, `disk`, etc
resources:
  gpu: 12GB..18GB
  memory: 16GB..32GB
